# üîê Senhas e Criptografia

Num cen√°rio cr√≠tico como um vazamento de credenciais de um banco de dados, o tipo de Hash usado nas senhas muda completamente o que um atacante pode conseguir, e isso √© um pequeno exemplo da grande import√¢ncia do entendimento deste t√≥pico.

Neste ano, ainda vejo grandes empresas usarem Hash MD5 para armazenamento de senhas, e houve um cen√°rio em uma delas em que atrav√©s de um ataque de SQL Injection consegui baixar todas as credenciais, e com um simples ataque de Bruteforce, consegui 90% das senhas.

N√£o √© necess√°rio um conhecimento profundo em criptografias para trabalhar como Pentester e/ou demais cargos de Infosec, somente entender o que significa cada t√≥pico e no m√°ximo ser capaz de criar um script que criptografa e descriptografa alguma informa√ß√£o. Somente se voc√™ seguir como especialista em criptografia que vai ser primordial voc√™ entender toda a matem√°tica por tr√°s dos algoritmos.

A seguir vou listar alguns t√≥picos deste assunto, importantes a serem estudados:

**Fun√ß√µes Hash criptogr√°fica:** √â de suma import√¢ncia entender quais destas fun√ß√µes Hash s√£o seguras e quais devemos evitar, como por exemplo utilizar bons algoritmos como **bcrypt** para armazenamento de senhas, e n√£o **SHA1, MD4, MD5**, e outros.

Existe tamb√©m um ataque bem conhecido neste ramo chamado **Length Extension**, que consiste em: Tendo uma mensagem original, uma chave secreta e um Hash dessas duas informa√ß√µes, √© poss√≠vel atrav√©s desse ataque, alterar a mensagem tendo apenas o tamanho da chave. Hash Extender(https://github.com/iagox86/hash\_extender) √© uma √≥tima ferramenta para isso.

**Encodes:** Muitas pessoas erroneamente ainda pensam que codifica√ß√µes s√£o criptografias, n√£o s√£o, pois n√£o h√° nenhuma senha no processo de codifica√ß√£o. Encodes est√£o presentes em quase todos os sistemas, principalmente o base64, muitas vezes informa√ß√µes sens√≠veis est√£o encodadas nesse algoritmo, e √© trivial saber identificar.

```sh
$ b64 SenhaSuperSecreta
U2VuaGFTdXBlclNlY3JldGE=
```

**Senhas Linux:** Antigamente as informa√ß√µes de senhas do Linux eram armazenadas em `/etc/passwd`, hoje esse arquivo somente lista informa√ß√µes como usu√°rios do sistema e atualmente as informa√ß√µes de senhas est√£o gravadas em `/etc/shadow`(onde somente usu√°rios administrativos t√™m acesso). Neste arquivo, as senhas seguem o seguinte formato:

```bash
linuxuser:$6$zHvrJMa5Y690smbQ$z5zdL...:18009:0:120:7:14::
```

Onde h√° o usu√°rio, o tipo de Hash, o Hash da senha, e outras informa√ß√µes da senha, como data de expira√ß√£o.

**Senha Windows:** As senhas Windows encontram-se no arquivo arquivo de banco de dados chamado **Security Account Manager (SAM)**, e localizado em `C:\Windows\System32\Config\SAM`, este arquivo armazena as senhas em formato Hash LM/NTLM.

Existe tamb√©m um processo chamado **Local Security Authority Server Service (LSASS)**, respons√°vel pela pol√≠tica de seguran√ßa do sistema, onde tamb√©m √© poss√≠vel obter as senhas atrav√©s desse processo.

Conseguir senhas Windows √© muito mais f√°cil do que as senhas Linux, inclusive este artigo do Hacktricks[https://book.hacktricks.xyz/windows-hardening/stealing-credentials](https://book.hacktricks.xyz/windows-hardening/stealing-credentials) possui diversos m√©todos para isso, mostrando o uso de ferramentas como [**NetExec**](https://github.com/Pennyw0rth/NetExec)**,** [**Mimikatz**](https://github.com/gentilkiwi/mimikatz) e outras:

{% embed url="https://book.hacktricks.xyz/windows-hardening/stealing-credentials" %}

Existe tamb√©m uma t√©cnica chamada **Pass The Hash** onde √© poss√≠vel em determinados servi√ßos do Windows server, como o SMB, conseguir uma autentica√ß√£o somente usando o Hash, sem saber a senha.

**Ferramentas de quebra de senha:** Durante uma an√°lise de seguran√ßa onde √© poss√≠vel obter um determinado Hash, √© bastante interessante tentar quebr√°-lo para obter a senha, com isso, o **John** e o **Hashcat** s√£o as excelentes ferramentas nesse processo, elas nativamente j√° vem no Kali Linux e s√£o bastante f√°ceis de serem usadas.

Tamb√©m √© poss√≠vel arriscar quebrar um Hash(principalmente os mais fracos, como MD5) usando ferramentas online, tais como: [https://hashkiller.io/](https://hashkiller.io/), [https://crackstation.net/](https://crackstation.net/) ou [https://hashes.com/](https://hashes.com/). Esses sites possuem databases que chegam de bilh√µes at√© trilh√µes de senhas, muitas vezes de vazamentos, por isso s√£o muito √∫teis.

**Criptografias Sim√©tricas e Assim√©tricas:** A **Criptografia Assim√©trica**, baseada em chaves p√∫blicas e privadas, est√° presente nos principais protocolos de comunica√ß√£o segura da Internet, como o **Transport Layer Security (TLS)**, respons√°vel por criptografar todas as requisi√ß√µes **HTTPS**.

Como dito anteriormente, n√£o √© preciso entender como funciona a matem√°tica por tr√°s desses algoritmos, apenas conhec√™-las, saber lidar com ferramentas como o **OpenSSL** e quais delas s√£o seguras. Vale a pena dar uma olhada numa implementa√ß√£o b√°sica em Python de **RSA, Curva El√≠ptica e Diffie-Hellman**.

J√° a **Criptografia Sim√©trica**, onde usa uma mesma chave para criptografar e descriptografar, pode ser encontrada em protocolos como o WPA/WPA2 usado em Wi-Fi 's, criptografia de arquivos em sistemas operacionais, em VPNs e outras situa√ß√µes. As mais comuns delas s√£o a **Advanced Encryption Standard (AES)** e **Triple Data Encryption Standard (3DES)**.
